/**
* JAVASCRIPT "Interminale"
* Version:    2015
* Author:     Jean-Charles Moussé
* Website:    http://www.interminale.fr.nf/
**/
function getuserliked(){var e=$(this).attr("data-postid");$(this);if(e in cachedData)return cachedData[e];var t="Erreur";return $.ajax({type:"POST",url:"/app/ajax/like-request.php",data:"idpost="+e+"&getuserlike=true",dataType:"html",async:!1,success:function(e){t=e}}),cachedData[e]=t,t}function afficher_plus(e){event.preventDefault();var t="#btnloadmore"+e,a=$("#comment"+e+" .comment").length,s="post_id="+e+"&lastcomment="+a+"&loadmore=true";$.ajax({type:"POST",url:"/app/ajax/comment-request.php",data:s,success:function(e){$(e).insertBefore(t).slideDown(),$(t).remove(),emojify.run(),linktohref(),$("time.timeago").timeago()}})}function update_posts(){var e=$(".post:first-child").attr("id"),t=e.split("postnum"),a=t[1],s="lastidpost="+a+"&updateposts=true";$.ajax({type:"POST",url:"/app/ajax/post-request.php",data:s,dataType:"json",success:function(e){1==e.status&&$("#beforePost").length&&($("#nopost").length&&$("#nopost").remove(),$(e.view).hide().insertBefore(".post").first().slideDown(),ohSnap("Nouvelle publication de "+e.auteur,"green"),emojify.run(),linktohref(),$("time.timeago").timeago())}}),setTimeout("update_posts()",15e3)}function update_msg_friend(){var e="updatenotif=true";$.ajax({type:"POST",url:"/ajax.php",data:e,dataType:"json",success:function(e){if(1==e.status){var t=$("li #limessage sup").length,a=$("li #limessage sup span").html(),s=$("li #liamis sup").length,n=$("li #liamis sup span").html();if(0==$("#messages-prives").length)if(e.nbrnewmsg>0&&a!=e.nbrnewmsg){if($("li #limessage").html('Messages <sup><span class="badge badge-primary">'+e.nbrnewmsg+"</span></sup>"),e.nbrnewmsg>a){var i=e.nbrnewmsg-a;i>1?ohSnap("Vous avez "+i+" nouveaux messages privé","green"):ohSnap("Nouveau message privé reçu","green")}}else 0==e.nbrnewmsg&&0!=t&&$("li #limessage").html('Messages <sup style="display: none;"><span class="badge badge-primary">'+e.nbrnewmsg+"</span></sup>");if(e.nbrnewfriend>0&&n!=e.nbrnewfriend){if($("li #liamis").html('Amis <sup><span class="badge badge-primary">'+e.nbrnewfriend+"</span></sup>"),e.nbrnewfriend>n){var i=e.nbrnewfriend-n;i>1?ohSnap("Vous avez "+i+" nouvelles demandes d'ami","green"):ohSnap("Nouvelle demande d'ami reçu","green")}}else 0==e.nbrnewfriend&&0!=s&&$("li #liamis").html('Amis <sup style="display: none;"><span class="badge badge-primary">'+e.nbrnewfriend+"</span></sup>")}}})}function linktohref(){$("p").each(function(){var e=new RegExp("(?![^<]*>)([a-z0-9+.-]+://[^\\s|<]+)","ig");$(this).html($(this).html().replace(e,"<a href='$1' target='_blank'>$1</a>"))})}function gotobottom(e){element=document.getElementById(e),element.scrollTop=element.scrollHeight}function playSound(e){$("#soundtoplay")[0].play()}function get_all_msg(){var e="getmsgchat=true";$.ajax({type:"POST",url:"/app/ajax/chat-request.php",data:e,dataType:"html",success:function(e){$("#tchat").html(e),emojify.run(),linktohref(),$("time.timeago").timeago()}})}function avoidanniv(){var e="dontseeanniv=true";$.ajax({type:"POST",url:"/app/ajax/events-request.php",data:e,success:function(e){}})}function avoidevent(){var e="dontseeevent=true";$.ajax({type:"POST",url:"/app/ajax/events-request.php",data:e,success:function(e){}})}function addloading(e){var t=$(e).html();$(e).addClass("disabled"),$(e).html(t+'<i class="fa fa-spinner fa-spin" style="margin-left: 5px;"></i>')}function valid_user_connected(e){var t="id_user="+e+"&validco=true";$.ajax({type:"POST",url:"/ajax.php",data:t,dataType:"json",success:function(e){}}),setTimeout("valid_user_connected("+e+")",2e4)}function verif_user_connected(e){var t="id_user="+e+"&validco_other=true";$.ajax({type:"POST",url:"/ajax.php",data:t,dataType:"json",success:function(e){1==e.status?$("#userspan").length&&$("#userspan i:first").length<1&&$("#userspan").prepend('<i class="fa fa-circle" id="user_connected" title="Connecté"></i> '):$("#userspan").length&&$("#userspan i:first").length>0&&$("#userspan i:first").remove()}}),setTimeout("verif_user_connected("+e+")",2e4)}function check_alluser_connected(e){var t="id_user="+e+"&checkuserco=true";$.ajax({type:"POST",url:"/ajax.php",data:t,dataType:"html",success:function(e){$(".allusersconnect").html(e)}}),setTimeout("check_alluser_connected("+e+")",2e4)}var cachedData=Array();$(document).on("click",".likebutton",function(e){e.preventDefault();var t=$(this).attr("data-postid"),a="#addlike"+t,s="#nbrlike"+t,n="#description"+t;delete cachedData[t],$.ajax({type:"POST",url:"/app/ajax/like-request.php",data:"id="+t+"&addlike=true",dataType:"json",success:function(e){1==e.status?$(a).hasClass("liked")?($(s).html(e.nbrlike),$(a).removeClass("liked")):($(s).html(e.nbrlike),$(a).addClass("liked")):$(e.err).insertBefore(n).slideDown()}})}),$(document).on("submit","form.formaddcomment",function(e){e.preventDefault();var t=$(this).attr("id"),a="#nbrcomment"+t,s="#commentinput"+t,n="#addcomment"+t,i=$.trim($(s).val());i=encodeURIComponent(i);var o="comment="+i+"&post_id="+t+"&addcomment=true";$("#submitnewcomment").attr("disabled",!0),$("#submitnewcomment").html('Envoi <i class="fa fa-spinner fa-spin"></i>'),""==i?($("#addcomment"+t+" #errorcomment").html("Veuillez saisir tous les champs").slideDown(),$("#submitnewcomment").removeAttr("disabled"),$("#submitnewcomment").html("Valider")):$.ajax({type:"POST",url:"/app/ajax/comment-request.php",data:o,dataType:"json",success:function(e){1==e.status?($("#addcomment"+t+" #errorcomment").hide().html(""),$(e.view).hide().insertAfter(n).slideDown(),$("#submitnewcomment").removeAttr("disabled"),$("#submitnewcomment").html("Valider"),$(s).val(""),$(a).html(e.nbrcomment),ohSnap("Votre commentaire a été ajouté","green"),emojify.run(),linktohref(),$("time.timeago").timeago()):$("#addcomment"+t+" #errorcomment").html(e.err).slideDown()}})}),$(document).on("click",".supprcomment",function(e){e.preventDefault();var t=$(this).attr("id"),a=$(this).attr("data-postid"),s="#nbrcomment"+a,n="#commentairenum"+t,i="supprcomment=true&comment_id="+t+"&post_id="+a;$.ajax({type:"POST",url:"/app/ajax/comment-request.php",data:i,dataType:"json",success:function(e){1==e.status?($(n).fadeOut(400).hide(function(){$(n).remove()}),$(s).html(e.nbrcomment),ohSnap("Votre commentaire a été supprimé","green")):$(e.err).hide().insertBefore(n).slideDown()}})}),$(document).on("click","#submitaddpost",function(e){e.preventDefault();var t=$.trim($("#inputPost").val());t=encodeURIComponent(t);var a=$(".inputConf:checked").val(),s="postajax="+t+"&confajax="+a+"&addpost=true";$("#submitaddpost").attr("disabled",!0),$("#submitaddpost").html('Publication <i class="fa fa-spinner fa-spin"></i>'),""==t?($("#errorpost").hide().html("Veuillez saisir tous les champs de texte !").slideDown(),$("#submitaddpost").html("Publier"),$("#submitaddpost").removeAttr("disabled")):""!=$("#fichierjoint").val()?$("#form-addpost").submit():$.ajax({type:"POST",url:"/app/ajax/post-request.php",data:s,dataType:"json",success:function(e){1==e.status?($("#inputPost").val(""),$("#errorpost").hide().html(""),$("#addPostModal").modal("hide"),$("#submitaddpost").html("Publier"),$("#submitaddpost").removeAttr("disabled"),$("#beforePost").length&&($("#nopost").length&&$("#nopost").remove(),$(e.view).hide().insertBefore(".post").first().slideDown(),ohSnap("Votre post a été ajouté","green"),emojify.run(),linktohref(),$("time.timeago").timeago()),$("#beforePostPublic").length&&"public"==a&&($("#nopost").length&&$("#nopost").remove(),$(e.view).hide().insertAfter("#beforePostPublic").first().slideDown(),ohSnap("Votre post a été ajouté","green"),emojify.run(),linktohref(),$("time.timeago").timeago()),$("#userbeforePost").length&&($("#nopost").length&&$("#nopost").remove(),$(e.view).hide().insertAfter("#userbeforePost").first().slideDown(),ohSnap("Votre post a été ajouté","green"),emojify.run(),linktohref(),$("time.timeago").timeago())):($("#errorpost").hide().html(e.err).slideDown(),$("#submitaddpost").html("Publier"),$("#submitaddpost").removeAttr("disabled"))}})}),$(document).on("click",".supprpost",function(e){e.preventDefault();var t=$(this).attr("data-postid"),a="#postnum"+t,s="post_id="+t+"&supprpost=true";$.ajax({type:"POST",url:"/app/ajax/post-request.php",data:s,dataType:"json",success:function(e){1==e.status?($(a).slideUp().hide(function(){$(a).remove()}),ohSnap("Votre post a été supprimé","green")):$(e.err).hide().insertBefore("#postcontent").first().slideDown()}})}),$("#listEmoji").on("click","img",function(){var e=$("#inputPost").val(),t=$(this).attr("title");$("#inputPost").val(e+" "+t)}),$(document).on("click","#acceptDemand",function(e){e.preventDefault();var t=$(this).attr("data-idinv"),a=$(this).attr("data-pseudoexp"),s=$(this).attr("data-username"),n="#demand"+t,i="idinvitation="+t+"&pseudo_exp="+a+"&acceptfriend=true";$.ajax({type:"POST",url:"/app/ajax/friends-request.php",data:i,dataType:"json",success:function(e){if(1==e.status){$(n).slideUp().hide(function(){$(n).remove()}),ohSnap(s+" est maintenant votre ami(e)","green");var t=$("li #liamis sup span").html(),a=t-1;a>0?$("li #liamis").html('Amis <sup><span class="badge badge-primary">'+a+"</span></sup>"):$("li #liamis").html('Amis <sup style="display: none;"><span class="badge badge-primary">'+a+"</span></sup>")}else ohSnap("Une erreur est survenue :/","red")}})}),$(document).on("click","#deniedDemand",function(e){e.preventDefault();var t=$(this).attr("data-idinv"),a=$(this).attr("data-pseudoexp"),s="#demand"+t,n="idinvitation="+t+"&pseudo_exp="+a+"&deniedfriend=true";$.ajax({type:"POST",url:"/app/ajax/friends-request.php",data:n,dataType:"json",success:function(e){if(1==e.status){$(s).slideUp().hide(function(){$(s).remove()}),ohSnap("La demande a bien été refusée","green");var t=$("li #liamis sup span").html(),a=t-1;a>0?$("li #liamis").html('Amis <sup><span class="badge badge-primary">'+a+"</span></sup>"):$("li #liamis").html('Amis <sup style="display: none;"><span class="badge badge-primary">'+a+"</span></sup>")}else ohSnap("Une erreur est survenue :/","red")}})}),$(function(){linktohref()});var searchuser=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("pseudo"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/ajax.php?dosearch=true&search=%QUERY%",wildcard:"%QUERY%"}});$("#custom-templates .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"searchuser",display:"pseudo",source:searchuser,limit:15,templates:{empty:['<div class="empty-message">',"Aucun résultat n'a été trouvé","</div>"].join("\n"),suggestion:function(e){return'<div><a class="no_underline" href="/profil/'+e.href+'" title="'+e.pseudo+'"><img class="img-circle img_result_search" src="'+e.imageprofil+'" alt="'+e.pseudo+'" style="width: 45px;height: 45px;"><h4 class="title_user_search" style="font-size: 18px;">'+e.pseudo+"</h4></a></div>"}}}),$("#file-input").change(function(){$("#newimgprofil").submit()}),$("#opentchat").click(function(){setTimeout(function(){gotobottom("tchat")},300),setTimeout(function(){0==$("#tchatmenu").hasClass("canvas-slid")?$("#opentchat").html('<i class="fa fa-chevron-left"></i>'):$("#opentchat").html('<i class="fa fa-chevron-right"></i>')},700)}),$(document).on("click","#submitaddfile",function(e){e.preventDefault();var t=$.trim($("#descfile").val());t=encodeURIComponent(t);var a=$("#fileinput").val();$(".inputConf:checked").val();$("#submitaddfile").attr("disabled",!0),$("#submitaddfile").html('Chargement <i class="fa fa-spinner fa-spin"></i>'),""==a||""==t?($("#errorpost").html("Veuillez saisir tous les champs !"),$("#submitaddfile").html("Publier"),$("#submitaddfile").removeAttr("disabled")):$("#form-addfile").submit()}),$(document).on("click","#submit_event",function(e){e.preventDefault();var t=$.trim($("#name_event").val()),t=encodeURIComponent(t),a=$.trim($("#desc_event").val()),a=encodeURIComponent(a),s=$.trim($("#date_event").val()),s=encodeURIComponent(s),n=$.trim($("#type_event").val()),n=encodeURIComponent(n),i=$(".public_event:checked").val(),o="name_event="+t+"&desc_event="+a+"&date_event="+s+"&type_event="+n+"&public_event="+i+"&addevent=true";$("#submit_event").attr("disabled",!0),$("#submit_event").html('Ajout <i class="fa fa-spinner fa-spin"></i>'),""==t||""==s||""==n||""==i?($("#errorpost").hide().html("Veuillez saisir tous les champs de texte !").slideDown(),$("#submit_event").html("Publier"),$("#submit_event").removeAttr("disabled")):$.ajax({type:"POST",url:"/app/ajax/events-request.php",data:o,dataType:"json",success:function(e){1==e.status?($("#name_event").val(""),$("#desc_event").val(""),$("#date_event").val(""),$("#errorpost").hide().html(""),$("#addevent").modal("hide"),$("#submit_event").html("Ajouter"),$("#submit_event").removeAttr("disabled"),ohSnap("L'évenement à été ajouté","green")):($("#errorpost").hide().html(e.err).slideDown(),$("#submit_event").html("Publier"),$("#submit_event").removeAttr("disabled"))}})}),$("#btnlistemoji").click(function(){$("i",this).toggleClass("fa fa-close")});